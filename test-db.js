// à¹„à¸Ÿà¸¥à¹Œ: test-db.js
import mongoose from 'mongoose';
import dotenv from 'dotenv';

// 1. à¸¥à¸­à¸‡à¹‚à¸«à¸¥à¸”à¸„à¹ˆà¸²à¸ˆà¸²à¸ .env
dotenv.config();

console.log("----------------------------------------");
console.log("ğŸ› ï¸  à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸”à¸ªà¸­à¸šà¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Database...");

// 2. à¹€à¸Šà¹‡à¸„à¸§à¹ˆà¸²à¸­à¹ˆà¸²à¸™à¸„à¹ˆà¸² Connection String à¹€à¸ˆà¸­à¹„à¸«à¸¡?
const uri = process.env.MONGO_URI;
console.log("ğŸ“ à¸­à¹ˆà¸²à¸™à¸„à¹ˆà¸² URI à¸ˆà¸²à¸ .env:", uri ? "âœ… à¹€à¸ˆà¸­à¹à¸¥à¹‰à¸§ (à¸‹à¹ˆà¸­à¸™à¸£à¸«à¸±à¸ªà¹„à¸§à¹‰)" : "âŒ à¹„à¸¡à¹ˆà¹€à¸ˆà¸­! (à¸„à¹ˆà¸²à¹€à¸›à¹‡à¸™ undefined)");

if (!uri) {
    console.error("âš ï¸  à¸ªà¸²à¹€à¸«à¸•à¸¸: à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸«à¸²à¹„à¸Ÿà¸¥à¹Œ .env à¹„à¸¡à¹ˆà¹€à¸ˆà¸­ à¸«à¸£à¸·à¸­à¹ƒà¸™à¹„à¸Ÿà¸¥à¹Œà¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸•à¸±à¹‰à¸‡à¸Šà¸·à¹ˆà¸­à¸•à¸±à¸§à¹à¸›à¸£à¸§à¹ˆà¸² MONGO_URI");
    console.log("ğŸ‘‰ à¸§à¸´à¸˜à¸µà¹à¸à¹‰: à¹€à¸Šà¹‡à¸„à¸§à¹ˆà¸²à¹„à¸Ÿà¸¥à¹Œ .env à¸­à¸¢à¸¹à¹ˆà¸—à¸µà¹ˆà¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸š package.json à¹„à¸«à¸¡?");
    process.exit(1);
}

// 3. à¸¥à¸­à¸‡à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ (à¸•à¸±à¹‰à¸‡à¹€à¸§à¸¥à¸²à¹à¸„à¹ˆ 5 à¸§à¸´à¸™à¸²à¸—à¸µ à¸à¸­)
console.log("â³ à¸à¸³à¸¥à¸±à¸‡à¸à¸¢à¸²à¸¢à¸²à¸¡à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ (à¸£à¸­ 5 à¸§à¸´à¸™à¸²à¸—à¸µ)...");

mongoose.connect(uri, {
    serverSelectionTimeoutMS: 5000 // à¸ªà¸³à¸„à¸±à¸: à¸–à¹‰à¸²à¹€à¸à¸´à¸™ 5 à¸§à¸´ à¹ƒà¸«à¹‰à¸•à¸±à¸”à¹€à¸¥à¸¢ à¸­à¸¢à¹ˆà¸²à¸„à¹‰à¸²à¸‡
})
.then(() => {
    console.log("âœ…âœ…âœ… à¸ªà¸³à¹€à¸£à¹‡à¸ˆ! à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Database à¹„à¸”à¹‰à¹à¸¥à¹‰à¸§");
    console.log("ğŸ‰ à¸ªà¸£à¸¸à¸›: à¸£à¸«à¸±à¸ªà¸–à¸¹à¸, IP à¸œà¹ˆà¸²à¸™, à¹€à¸™à¹‡à¸•à¹ƒà¸Šà¹‰à¹„à¸”à¹‰");
    console.log("----------------------------------------");
    process.exit(0);
})
.catch((err) => {
    console.log("âŒâŒâŒ à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§! à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹„à¸¡à¹ˆà¹„à¸”à¹‰");
    console.error("ğŸ’¥ Error Message:", err.message);
    console.log("----------------------------------------");
    process.exit(1);
});