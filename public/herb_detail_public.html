<!DOCTYPE html>
<html class="light" lang="th">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Herb Detail | SkinHerbCare</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
  
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#30e89c",
            "primary-dark": "#1a8a5b",
            "primary-light": "#e9f7f0",
            "background-light": "#f8fdfb"
          },
          fontFamily: {
            display: ["Manrope", "sans-serif"],
            serif: ["Playfair Display", "serif"]
          }
        }
      }
    };
  </script>
  <style>
    body {
      background: linear-gradient(160deg, #e0f2f1 0%, #dcfce7 100%);
      overflow-x: hidden;
      position: relative;
    }
    body::before,
    body::after {
      position: fixed;
      z-index: -1;
      opacity: 0.35;
      pointer-events: none;
    }
    body::before {
      content: "üåø";
      bottom: -60px;
      left: -60px;
      font-size: 260px;
      transform: rotate(-25deg);
    }
    body::after {
      content: "üåø";
      top: -80px;
      right: -80px;
      font-size: 300px;
      transform: rotate(20deg);
    }
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #30e89c; border-radius: 10px; }
    .leaf-bg {
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 0c15 0 30 15 30 30S45 60 30 60 0 45 0 30 15 0 30 0z' fill='%2330e89c' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
    }
  </style>
</head>
<body class="font-display bg-background-light text-slate-800 antialiased h-screen overflow-hidden relative">

  <div class="absolute inset-0 leaf-bg -z-10"></div>

  <a href="index.html" class="absolute top-6 left-6 z-50 bg-white/80 backdrop-blur px-4 py-2 rounded-full shadow-sm hover:shadow-md transition-all flex items-center gap-2 text-slate-600 font-bold text-sm">
    <span class="material-symbols-outlined text-lg">arrow_back</span>
    ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
  </a>

  <a href="herb_library.html" class="absolute top-6 right-6 z-50 bg-white/80 backdrop-blur px-4 py-2 rounded-full shadow-sm hover:shadow-md transition-all flex items-center gap-2 text-slate-600 font-bold text-sm">
    <span class="material-symbols-outlined text-lg">menu_book</span>
    ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£
  </a>

  <div class="h-full w-full flex items-center justify-center p-4 md:p-8">
    <div class="relative w-full max-w-7xl h-full max-h-[900px] bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row border border-white/50">
      
      <div class="w-full md:w-5/12 relative h-64 md:h-auto overflow-hidden bg-slate-100 group">
        <img id="herb-image" alt="Herb Image" class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105" src="https://via.placeholder.com/600?text=Loading..."/>
        
        <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent"></div>
        
        <div class="absolute bottom-8 left-8 text-white">
          <span class="px-3 py-1 bg-primary text-white text-[10px] font-bold uppercase tracking-widest rounded-full mb-2 inline-block">Natural Ingredient</span>
          <h2 id="img-caption-name" class="text-3xl font-serif italic opacity-90">...</h2>
        </div>
      </div>

      <div class="w-full md:w-7/12 flex flex-col h-full bg-white relative">
        <div class="flex-grow overflow-y-auto custom-scrollbar p-8 md:p-12">
          
          <header class="mb-10 border-b border-slate-100 pb-8">
            <div class="flex items-baseline gap-3 mb-2">
              <h1 id="herb-name" class="text-4xl md:text-5xl font-extrabold text-slate-900">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h1>
            </div>
            <p id="herb-sci" class="font-serif italic text-xl text-primary-dark/70 mb-6">Scientific Name Loading...</p>
            
            <div class="bg-primary-light/50 p-6 rounded-2xl border border-primary/10">
              <h3 class="text-xs font-bold text-primary-dark uppercase tracking-widest mb-2 flex items-center gap-2">
                <span class="material-symbols-outlined text-lg">verified</span> ‡∏™‡∏£‡∏£‡∏û‡∏Ñ‡∏∏‡∏ì‡∏´‡∏•‡∏±‡∏Å
              </h3>
              <p id="herb-properties" class="text-slate-700 text-lg font-medium leading-relaxed">...</p>
            </div>
          </header>

          <div class="space-y-8">
            
            <section>
              <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-3">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞</h3>
              <p id="herb-description" class="text-slate-600 leading-relaxed">...</p>
            </section>

            <section>
              <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ</h3>
              <div class="bg-slate-50 p-6 rounded-2xl border-l-4 border-primary">
                <p id="herb-usage" class="text-slate-600 leading-relaxed">...</p>
              </div>
            </section>

            <section>
              <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4">‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ/‡∏≠‡∏≤‡∏Å‡∏≤‡∏£</h3>
              <div id="herb-diseases-container" class="flex flex-wrap gap-2">
                <span class="px-4 py-2 bg-slate-100 text-slate-500 rounded-lg text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
              </div>
            </section>

          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE_URL = window.location.hostname.includes('netlify.app')
      ? 'https://skinherbcareweb1.onrender.com'
      : window.location.origin;

    function resolveImageSrc(raw) {
      if (!raw) return '';
      const val = String(raw).trim();
      if (!val) return '';
      if (val.startsWith('http://') || val.startsWith('https://') || val.startsWith('data:')) return val;
      if (val.startsWith('/uploads/')) return `${window.location.origin}${val}`;
      const normalized = val.replace(/\\/g, '/');
      const idx = normalized.lastIndexOf('/uploads/');
      if (idx >= 0) return `${window.location.origin}${normalized.slice(idx)}`;
      if (/\.(png|jpe?g|gif|webp)$/i.test(val)) return `${window.location.origin}/uploads/${val}`;
      return val;
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const herbId = urlParams.get('id');

      if (!herbId) {
        window.location.href = 'index.html';
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/api/herbs/${herbId}`);
        if (!response.ok) throw new Error('Network response was not ok');

        const json = await response.json();
        const herb = json.herb || json.data || json;

        const imgEl = document.getElementById('herb-image');
        const imageSrc = resolveImageSrc(herb.image || '');
        imgEl.src = imageSrc || 'https://via.placeholder.com/600?text=No+Image';
        document.getElementById('img-caption-name').innerText = herb.name || '-';

        document.getElementById('herb-name').innerText = herb.name || '-';
        document.getElementById('herb-sci').innerText = herb.scientificName || herb.engName || '-';

        const props = Array.isArray(herb.properties) ? herb.properties.join(', ') : (herb.properties || '-');
        document.getElementById('herb-properties').innerText = props;

        const descEl = document.getElementById('herb-description');
        descEl.innerText = herb.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°';

        document.getElementById('herb-usage').innerText = herb.usage || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ';

        const diseasesContainer = document.getElementById('herb-diseases-container');
        const diseasesData = herb.diseases || herb.treatment || [];
        const diseaseList = Array.isArray(diseasesData) ? diseasesData : String(diseasesData).split(',');
        const cleaned = diseaseList.map(d => d.trim()).filter(Boolean);

        if (cleaned.length > 0) {
          diseasesContainer.innerHTML = '';
          cleaned.forEach((d) => {
            const tag = document.createElement('span');
            tag.className = "px-4 py-2 bg-primary/10 text-primary-dark font-bold rounded-lg text-sm shadow-sm";
            tag.innerText = d;
            diseasesContainer.appendChild(tag);
          });
        }

      } catch (error) {
        document.getElementById('herb-name').innerText = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        document.getElementById('herb-description').innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏°‡∏∏‡∏ô‡πÑ‡∏û‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß";
      }
    });
  </script>
</body>
</html>
