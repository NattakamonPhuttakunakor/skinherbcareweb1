<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkinHerbCare - หน้าแรก</title>
<style>
@import url("https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap");

:root {
  --bg-start: #e0f2f1;
  --bg-end: #dcfce7;
  --card-bg: linear-gradient(to bottom, rgba(245, 255, 250, 0.8), rgba(240, 253, 245, 0.8));
  --text-main: #064e3b;
  --text-sub: #334155;
  --border: rgba(255, 255, 255, 0.4);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Sarabun", sans-serif;
  background: linear-gradient(160deg, var(--bg-start), var(--bg-end));
  color: var(--text-main);
}

body::before,
body::after {
  position: fixed;
  z-index: -1;
  opacity: 0.35;
  pointer-events: none;
}

body::before {
  content: "🌿";
  bottom: -60px;
  left: -60px;
  font-size: 260px;
  transform: rotate(-25deg);
}

body::after {
  content: "🌿";
  top: -80px;
  right: -80px;
  font-size: 300px;
  transform: rotate(20deg);
}

.top-nav {
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(10px);
  background: rgba(255,255,255,0.4);
  border-bottom: 1px solid var(--border);
}

.nav-inner {
  max-width: 1200px;
  margin: auto;
  padding: 12px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
}

.logo {
  color: var(--text-main);
  text-decoration: none;
  font-size: 1.8rem;
  font-weight: 700;
}

.nav-links {
  display: flex;
  gap: 8px;
  align-items: center;
}

.nav-links a,
.nav-links button {
  border: none;
  background: transparent;
  text-decoration: none;
  color: var(--text-main);
  font-weight: 600;
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
  font-family: inherit;
  font-size: 0.95rem;
}

.nav-links a:hover,
.nav-links button:hover {
  background: rgba(255,255,255,0.7);
}

.profile-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255,255,255,0.85);
  border: 1px solid rgba(0,0,0,0.06);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  padding: 0;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 24px 20px 80px;
}

.main-card {
  max-width: 600px;
  margin: 24px auto 0;
  padding: 28px;
  border-radius: 24px;
  background: var(--card-bg);
  border: 1px solid var(--border);
  backdrop-filter: blur(12px);
  box-shadow: 0 12px 30px rgba(0,0,0,0.08);
}

.main-card h1 {
  margin: 0 0 10px;
  text-align: center;
  font-size: 2rem;
}

.main-card p {
  margin: 0 0 24px;
  text-align: center;
  color: #475569;
}

.features {
  display: grid;
  gap: 14px;
}

.feature {
  display: flex;
  align-items: center;
  gap: 16px;
  border-radius: 14px;
  background: rgba(255,255,255,0.55);
  border: 1px solid rgba(255,255,255,0.5);
  padding: 16px;
  text-decoration: none;
  color: inherit;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.feature:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 20px rgba(15,23,42,0.08);
}

.icon {
  width: 52px;
  height: 52px;
  border-radius: 12px;
  background: rgba(236,253,245,0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.3rem;
}

.feature h3 {
  margin: 0 0 2px;
  color: #064e3b;
}

.feature p {
  margin: 0;
  text-align: left;
  color: var(--text-sub);
}

.section {
  margin-top: 52px;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: end;
  gap: 10px;
  margin-bottom: 16px;
}

.section-header h2 {
  margin: 0;
}

.section-header p {
  margin: 4px 0 0;
  color: #475569;
}

.section-link {
  text-decoration: none;
  font-weight: 700;
  color: #065f46;
  background: rgba(255,255,255,0.75);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 8px 12px;
}

.grid {
  display: grid;
  gap: 16px;
  grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
}

.card {
  border-radius: 16px;
  overflow: hidden;
  background: rgba(255,255,255,0.75);
  border: 1px solid rgba(255,255,255,0.6);
  box-shadow: 0 14px 30px rgba(15, 23, 42, 0.1);
  display: flex;
  flex-direction: column;
}

.card-media {
  height: 170px;
  background: #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #64748b;
}

.card-media img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.card-body {
  padding: 14px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  flex: 1;
}

.card-title {
  margin: 0;
  font-size: 1.05rem;
  color: #0f172a;
}

.card-desc {
  margin: 0;
  color: #475569;
  font-size: 0.9rem;
}

.card-btn {
  margin-top: auto;
  text-decoration: none;
  text-align: center;
  font-weight: 700;
  color: #0f766e;
  background: rgba(16,185,129,0.14);
  border-radius: 10px;
  padding: 9px 12px;
}

.loading {
  grid-column: 1 / -1;
  text-align: center;
  color: #64748b;
  padding: 20px;
  background: rgba(255,255,255,0.55);
  border-radius: 14px;
  border: 1px dashed rgba(16,185,129,0.2);
}

@media (max-width: 640px) {
  .logo { font-size: 1.35rem; }
  .main-card h1 { font-size: 1.35rem; }
  .main-card { padding: 20px; }
}
</style>
</head>
<body>

<nav class="top-nav">
  <div class="nav-inner">
    <a href="/index.html" class="logo">🌿 SkinHerbCare</a>

    <div class="nav-links" id="guest-nav">
      <a href="/index.html">Home</a>
      <a href="/login.html">Log In</a>
      <a href="/register.html">Sign Up</a>
      <button id="profile-btn-guest" class="profile-icon" aria-label="Profile">
        <span>👤</span>
      </button>
    </div>

    <div class="nav-links" id="admin-nav" style="display:none;">
      <a href="/index.html">Home</a>
      <a href="/admin-dashboard.html" style="background:#FFC107;color:#111C44;">จัดการระบบ</a>
      <button onclick="logout()">Log Out</button>
      <button id="profile-btn-admin" class="profile-icon" aria-label="Profile">
        <span>👤</span>
      </button>
    </div>
  </div>
</nav>

<div class="container">
  <div class="main-card">
    <h1>ยินดีต้อนรับสู่เว็บไซต์แนะนำสมุนไพรรักษาโรคผิวหนัง</h1>
    <p>โปรดเลือกประเภทการใช้งาน</p>

    <div class="features">
      <a class="feature" href="/analyze-disease.html" onclick="checkLogin(event)">
        <div class="icon">🔍</div>
        <div>
          <h3>วิเคราะห์รูปโรคผิวหนัง</h3>
          <p>อัปโหลดภาพถ่ายผิวเพื่อรับการวิเคราะห์เบื้องต้น</p>
        </div>
      </a>

      <a class="feature" href="/analyze-herb.html">
        <div class="icon">🌱</div>
        <div>
          <h3>ค้นหาข้อมูลจากรูปสมุนไพร</h3>
          <p>อัปโหลดภาพสมุนไพรเพื่อค้นหาข้อมูลและสรรพคุณ</p>
        </div>
      </a>

      <a class="feature" href="/analyze-symptoms.html" onclick="checkLogin(event)">
        <div class="icon">📝</div>
        <div>
          <h3>วิเคราะห์จากอาการที่พิมพ์</h3>
          <p>บอกอาการของคุณเพื่อรับคำแนะนำสมุนไพร</p>
        </div>
      </a>
    </div>
  </div>

  <section class="section">
    <div class="section-header">
      <div>
        <h2>คลังสมุนไพรแนะนำ</h2>
        <p>อัปเดตจากฐานข้อมูลล่าสุด</p>
      </div>
      <a class="section-link" href="/herb_library.html">ดูทั้งหมด</a>
    </div>
    <div class="grid" id="herb-showcase-container">
      <div class="loading">กำลังโหลดข้อมูลสมุนไพร...</div>
    </div>
  </section>

  <section class="section">
    <div class="section-header">
      <div>
        <h2>โรครอบตัวแนะนำ</h2>
        <p>รายการโรคที่เผยแพร่จากระบบล่าสุด</p>
      </div>
      <a class="section-link" href="/disease_library.html">ดูทั้งหมด</a>
    </div>
    <div class="grid" id="disease-showcase-container">
      <div class="loading">กำลังโหลดข้อมูลโรค...</div>
    </div>
  </section>
</div>

<script>
function checkLoginStatus() {
  const userRole = localStorage.getItem('userRole');
  const guestNav = document.getElementById('guest-nav');
  const adminNav = document.getElementById('admin-nav');
  if (userRole === 'admin') {
    guestNav.style.display = 'none';
    adminNav.style.display = 'flex';
  } else {
    guestNav.style.display = 'flex';
    adminNav.style.display = 'none';
  }
}

function logout() {
  if (!confirm('ต้องการออกจากระบบหรือไม่?')) return;
  ['token','userToken','user','userRole'].forEach(k => {
    localStorage.removeItem(k);
    sessionStorage.removeItem(k);
  });
  location.reload();
}

function checkLogin(event) {
  const token = localStorage.getItem('token') || localStorage.getItem('userToken');
  if (!token) {
    event.preventDefault();
    window.location.href = '/login.html';
  }
}

const API_BASE_URL = window.location.hostname.includes('netlify.app')
  ? 'https://skinherbcareweb1.onrender.com'
  : window.location.origin;

function resolveImageSrc(raw) {
  if (!raw) return '';
  const val = String(raw).trim();
  if (!val) return '';
  if (val.startsWith('http://') || val.startsWith('https://') || val.startsWith('data:')) return val;
  if (val.startsWith('/uploads/')) return `${window.location.origin}${val}`;
  const normalized = val.replace(/\\/g, '/');
  const idx = normalized.lastIndexOf('/uploads/');
  if (idx >= 0) return `${window.location.origin}${normalized.slice(idx)}`;
  if (/\.(png|jpe?g|gif|webp)$/i.test(val)) return `${window.location.origin}/uploads/${val}`;
  return val;
}

async function loadShowcaseHerbs() {
  const container = document.getElementById('herb-showcase-container');
  if (!container) return;
  try {
    const response = await fetch(`${API_BASE_URL}/api/herbs`);
    if (!response.ok) throw new Error('โหลดข้อมูลไม่สำเร็จ');
    const json = await response.json();
    const herbs = Array.isArray(json) ? json : (json.herbs || json.data || []);
    if (!Array.isArray(herbs) || herbs.length === 0) {
      container.innerHTML = '<div class="loading">ยังไม่มีข้อมูลสมุนไพร</div>';
      return;
    }

    container.innerHTML = herbs.slice(0, 4).map((herb) => {
      const propertiesText = Array.isArray(herb.properties) ? herb.properties.join(', ') : (herb.properties || '');
      const shortDesc = propertiesText.length > 90 ? `${propertiesText.substring(0, 90)}...` : (propertiesText || 'ไม่มีข้อมูลสรรพคุณ');
      const imageSrc = resolveImageSrc(herb.image || '');
      const herbId = herb._id || herb.id || '';
      return `
      <div class="card">
        <div class="card-media">${imageSrc ? `<img src="${imageSrc}" alt="${herb.name || 'Herb'}">` : 'No Image'}</div>
        <div class="card-body">
          <h3 class="card-title">${herb.name || 'ไม่ระบุชื่อ'}</h3>
          <p class="card-desc">${shortDesc}</p>
          <a class="card-btn" href="/herb_detail_public.html?id=${herbId}">อ่านเพิ่มเติม</a>
        </div>
      </div>`;
    }).join('');
  } catch (e) {
    container.innerHTML = '<div class="loading">เกิดข้อผิดพลาดในการโหลดข้อมูล</div>';
  }
}

async function loadShowcaseDiseases() {
  const container = document.getElementById('disease-showcase-container');
  if (!container) return;
  try {
    const response = await fetch(`${API_BASE_URL}/api/diseases`);
    if (!response.ok) throw new Error('โหลดข้อมูลไม่สำเร็จ');
    const json = await response.json();
    const diseases = Array.isArray(json) ? json : (json.diseases || json.data || []);
    if (!Array.isArray(diseases) || diseases.length === 0) {
      container.innerHTML = '<div class="loading">ยังไม่มีข้อมูลโรคที่เผยแพร่</div>';
      return;
    }

    container.innerHTML = diseases.slice(0, 4).map((disease) => {
      const symptomsText = Array.isArray(disease.symptoms) ? disease.symptoms.join(', ') : (disease.symptoms || '');
      const shortDesc = symptomsText.length > 90 ? `${symptomsText.substring(0, 90)}...` : (symptomsText || disease.description || 'ไม่มีข้อมูลอาการ');
      const diseaseId = disease._id || disease.id || '';
      const imageSrc = resolveImageSrc(disease.image || disease.imageUrl || disease.photo || '');
      return `
      <div class="card">
        <div class="card-media">${imageSrc ? `<img src="${imageSrc}" alt="${disease.name || 'Disease'}">` : 'Disease'}</div>
        <div class="card-body">
          <h3 class="card-title">${disease.name || 'ไม่ระบุชื่อโรค'}</h3>
          <p class="card-desc">${shortDesc}</p>
          <a class="card-btn" href="/disease_detail_public.html?id=${diseaseId}">อ่านเพิ่มเติม</a>
        </div>
      </div>`;
    }).join('');
  } catch (e) {
    container.innerHTML = '<div class="loading">เกิดข้อผิดพลาดในการโหลดข้อมูลโรค</div>';
  }
}

document.addEventListener('DOMContentLoaded', () => {
  checkLoginStatus();
  loadShowcaseHerbs();
  loadShowcaseDiseases();
});
</script>
<script src="/js/profile-drawer.js?v=20260211r15"></script>
<script src="/js/auth.js?v=20260211r15"></script>
</body>
</html>
